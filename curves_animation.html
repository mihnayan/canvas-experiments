<!DOCTYPE html>
<html>
<head>
    <title>Mihnayan experiments with Canvas</title>
</head>
<body>
    <canvas id="cnv" width="1024" height="768"></canvas>
    <script type="text/javascript" src="mihnayan.graphic.js"></script>
    <script type="text/javascript" src="figures.js"></script>
    <script type="text/javascript">
        var settings = {
            maxNumberOfLegs: 4,
            maxLegRPM: 2,
            minLegRPM: 0.5
        }
    </script>
    <script type="text/javascript">
        window.onload = function () {
            var ctx = document.getElementById("cnv").getContext("2d");
            graphics.init({
                canvasContext: ctx, 
                backgroundColor: '#000'
            });

            var getRandomLegRevolutionTime = function () {
                var rpm = Math.random() * (settings.maxLegRPM - settings.minLegRPM) + settings.minLegRPM;
                return 1000 / rpm;
            }

            var am = graphics.animator(0,0, 400,400);
            var eventManager = graphics.getEventManager();

            var currentNumberOfLegs = 1;

            var eyeballStatic = am.getStaticMotion(eyeball);
            am.addMotion(eyeballStatic);

            var fishTransformMotion = am.getTransformMotion(fish, mouth, 3000);
            am.addMotion(fishTransformMotion);
            fishTransformMotion.pause();

            var legRotateMotion = am.getRotateMotion(leg, 210, 150, -360*10, 10*getRandomLegRevolutionTime());
            am.addMotion(legRotateMotion);
            legRotateMotion.onEnd = function (motion) {
                motion.repeat();
            }

            var fishId = eventManager.addObservedFigure(fish);
            eventManager.addFigureEvent(fishId, 'mousemove', function () {
                fishTransformMotion.resume();
            });

            var eyeballId = eventManager.addObservedFigure(eyeball);
            eventManager.addFigureEvent(eyeballId, 'click', function () {
                if (currentNumberOfLegs >= settings.maxNumberOfLegs) return;
                var newLeg = graphics.copyFigure(leg);
                var newLegRotateMotion = am.getRotateMotion(newLeg, 210, 150, -360*10, 10*getRandomLegRevolutionTime());
                am.addMotion(newLegRotateMotion);
                newLegRotateMotion.start();
                currentNumberOfLegs++;
            });

            am.start();
        }
    </script>
</body>
</html>